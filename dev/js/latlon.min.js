function LatLon(b,c,a){if(typeof(a)=="undefined"){a=6371}this._lat=typeof(b)=="number"?b:typeof(b)=="string"&&b.trim()!=""?+b:NaN;this._lon=typeof(c)=="number"?c:typeof(c)=="string"&&c.trim()!=""?+c:NaN;this._radius=typeof(a)=="number"?a:typeof(a)=="string"&&trim(c)!=""?+a:NaN}LatLon.prototype.distanceTo=function(p,h){if(typeof h=="undefined"){h=4}var g=this._radius;var f=this._lat.toRad(),j=this._lon.toRad();var e=p._lat.toRad(),i=p._lon.toRad();var m=e-f;var b=i-j;var o=Math.sin(m/2)*Math.sin(m/2)+Math.cos(f)*Math.cos(e)*Math.sin(b/2)*Math.sin(b/2);var n=2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o));var k=g*n;return k.toPrecisionFixed(h)};LatLon.prototype.bearingTo=function(b){var f=this._lat.toRad(),e=b._lat.toRad();var c=(b._lon-this._lon).toRad();var g=Math.sin(c)*Math.cos(e);var a=Math.cos(f)*Math.sin(e)-Math.sin(f)*Math.cos(e)*Math.cos(c);var d=Math.atan2(g,a);return(d.toDeg()+360)%360};LatLon.prototype.finalBearingTo=function(b){var f=b._lat.toRad(),e=this._lat.toRad();var c=(this._lon-b._lon).toRad();var g=Math.sin(c)*Math.cos(e);var a=Math.cos(f)*Math.sin(e)-Math.sin(f)*Math.cos(e)*Math.cos(c);var d=Math.atan2(g,a);return(d.toDeg()+180)%360};LatLon.prototype.midpointTo=function(b){lat1=this._lat.toRad(),lon1=this._lon.toRad();lat2=b._lat.toRad();var c=(b._lon-this._lon).toRad();var a=Math.cos(lat2)*Math.cos(c);var d=Math.cos(lat2)*Math.sin(c);lat3=Math.atan2(Math.sin(lat1)+Math.sin(lat2),Math.sqrt((Math.cos(lat1)+a)*(Math.cos(lat1)+a)+d*d));lon3=lon1+Math.atan2(d,Math.cos(lat1)+a);return new LatLon(lat3.toDeg(),lon3.toDeg())};LatLon.prototype.destinationPoint=function(a,f){f=typeof(f)=="number"?f:typeof(f)=="string"&&f.trim()!=""?+f:NaN;f=f/this._radius;a=a.toRad();var e=this._lat.toRad(),c=this._lon.toRad();var d=Math.asin(Math.sin(e)*Math.cos(f)+Math.cos(e)*Math.sin(f)*Math.cos(a));var b=c+Math.atan2(Math.sin(a)*Math.sin(f)*Math.cos(e),Math.cos(f)-Math.sin(e)*Math.sin(d));b=(b+3*Math.PI)%(2*Math.PI)-Math.PI;return new LatLon(d.toDeg(),b.toDeg())};LatLon.intersection=function(d,b,c,a){b=typeof b=="number"?b:typeof b=="string"&&trim(b)!=""?+b:NaN;a=typeof a=="number"?a:typeof a=="string"&&trim(a)!=""?+a:NaN;lat1=d._lat.toRad(),lon1=d._lon.toRad();lat2=c._lat.toRad(),lon2=c._lon.toRad();brng13=b.toRad(),brng23=a.toRad();dLat=lat2-lat1,dLon=lon2-lon1;dist12=2*Math.asin(Math.sqrt(Math.sin(dLat/2)*Math.sin(dLat/2)+Math.cos(lat1)*Math.cos(lat2)*Math.sin(dLon/2)*Math.sin(dLon/2)));if(dist12==0){return null}brngA=Math.acos((Math.sin(lat2)-Math.sin(lat1)*Math.cos(dist12))/(Math.sin(dist12)*Math.cos(lat1)));if(isNaN(brngA)){brngA=0}brngB=Math.acos((Math.sin(lat1)-Math.sin(lat2)*Math.cos(dist12))/(Math.sin(dist12)*Math.cos(lat2)));if(Math.sin(lon2-lon1)>0){brng12=brngA;brng21=2*Math.PI-brngB}else{brng12=2*Math.PI-brngA;brng21=brngB}alpha1=(brng13-brng12+Math.PI)%(2*Math.PI)-Math.PI;alpha2=(brng21-brng23+Math.PI)%(2*Math.PI)-Math.PI;if(Math.sin(alpha1)==0&&Math.sin(alpha2)==0){return null}if(Math.sin(alpha1)*Math.sin(alpha2)<0){return null}alpha3=Math.acos(-Math.cos(alpha1)*Math.cos(alpha2)+Math.sin(alpha1)*Math.sin(alpha2)*Math.cos(dist12));dist13=Math.atan2(Math.sin(dist12)*Math.sin(alpha1)*Math.sin(alpha2),Math.cos(alpha2)+Math.cos(alpha1)*Math.cos(alpha3));lat3=Math.asin(Math.sin(lat1)*Math.cos(dist13)+Math.cos(lat1)*Math.sin(dist13)*Math.cos(brng13));dLon13=Math.atan2(Math.sin(brng13)*Math.sin(dist13)*Math.cos(lat1),Math.cos(dist13)-Math.sin(lat1)*Math.sin(lat3));lon3=lon1+dLon13;lon3=(lon3+Math.PI)%(2*Math.PI)-Math.PI;return new LatLon(lat3.toDeg(),lon3.toDeg())};LatLon.prototype.rhumbDistanceTo=function(i){var e=this._radius;var d=this._lat.toRad(),c=i._lat.toRad();var g=(i._lat-this._lat).toRad();var a=Math.abs(i._lon-this._lon).toRad();var f=Math.log(Math.tan(c/2+Math.PI/4)/Math.tan(d/2+Math.PI/4));var b=(!isNaN(g/f))?g/f:Math.cos(d);if(a>Math.PI){a=2*Math.PI-a}var h=Math.sqrt(g*g+b*b*a*a)*e;return h.toPrecisionFixed(4)};LatLon.prototype.rhumbBearingTo=function(a){var e=this._lat.toRad(),d=a._lat.toRad();var b=(a._lon-this._lon).toRad();var f=Math.log(Math.tan(d/2+Math.PI/4)/Math.tan(e/2+Math.PI/4));if(Math.abs(b)>Math.PI){b=b>0?-(2*Math.PI-b):(2*Math.PI+b)}var c=Math.atan2(b,f);return(c.toDeg()+360)%360};LatLon.prototype.rhumbDestinationPoint=function(g,m){var f=this._radius;var j=parseFloat(m)/f;var e=this._lat.toRad(),i=this._lon.toRad();g=g.toRad();var c=e+j*Math.cos(g);var k=c-e;var h=Math.log(Math.tan(c/2+Math.PI/4)/Math.tan(e/2+Math.PI/4));var b=(!isNaN(k/h))?k/h:Math.cos(e);var a=j*Math.sin(g)/b;if(Math.abs(c)>Math.PI/2){c=c>0?Math.PI-c:-(Math.PI-c)}lon2=(i+a+3*Math.PI)%(2*Math.PI)-Math.PI;return new LatLon(c.toDeg(),lon2.toDeg())};LatLon.prototype.lat=function(a,b){if(typeof a=="undefined"){return this._lat}return Geo.toLat(this._lat,a,b)};LatLon.prototype.lon=function(a,b){if(typeof a=="undefined"){return this._lon}return Geo.toLon(this._lon,a,b)};LatLon.prototype.toString=function(a,b){if(typeof a=="undefined"){a="dms"}if(isNaN(this._lat)||isNaN(this._lon)){return"-,-"}return Geo.toLat(this._lat,a,b)+", "+Geo.toLon(this._lon,a,b)};if(typeof(Number.prototype.toRad)==="undefined"){Number.prototype.toRad=function(){return this*Math.PI/180}}if(typeof(Number.prototype.toDeg)==="undefined"){Number.prototype.toDeg=function(){return this*180/Math.PI}}if(typeof(Number.prototype.toPrecisionFixed)==="undefined"){Number.prototype.toPrecisionFixed=function(b){if(isNaN(this)){return"NaN"}var c=this<0?-this:this;var a=this<0?"-":"";if(c==0){e="0.";while(b--){e+="0"}return e}var d=Math.ceil(Math.log(c)*Math.LOG10E);var e=String(Math.round(c*Math.pow(10,b-d)));if(d>0){l=d-e.length;while(l-->0){e=e+"0"}if(d<e.length){e=e.slice(0,d)+"."+e.slice(d)}}else{while(d++<0){e="0"+e}e="0."+e}return a+e}}if(typeof(String.prototype.trim)==="undefined"){String.prototype.trim=function(){return String(this).replace(/^\s\s*/,"").replace(/\s\s*$/,"")}}var Geo={};Geo.parseDMS=function(b){if(typeof a=="object"){throw new TypeError("Geo.parseDMS - dmsStr is [DOM?] object")}if(typeof b==="number"&&isFinite(b)){return Number(b)}var c=String(b).trim().replace(/^-/,"").replace(/[NSEW]$/i,"").split(/[^0-9.,]+/);if(c[c.length-1]==""){c.splice(c.length-1)}if(c==""){return NaN}switch(c.length){case 3:var a=c[0]/1+c[1]/60+c[2]/3600;break;case 2:var a=c[0]/1+c[1]/60;break;case 1:var a=c[0];if(/[NS]/i.test(b)){a="0"+a}if(/[0-9]{7}/.test(a)){a=a.slice(0,3)/1+a.slice(3,5)/60+a.slice(5)/3600}break;default:return NaN}if(/^-|[WS]$/i.test(b.trim())){a=-a}return Number(a)};Geo.toDMS=function(f,g,i){if(typeof f=="object"){throw new TypeError("Geo.toDMS - deg is [DOM?] object")}if(isNaN(f)){return"NaN"}if(typeof g=="undefined"){g="dms"}if(typeof i=="undefined"){switch(g){case"d":i=4;break;case"dm":i=2;break;case"dms":i=0;break;default:g="dms";i=0}}f=Math.abs(f);switch(g){case"d":h=f.toFixed(i);if(h<100){h="0"+h}if(h<10){h="0"+h}dms=h+"\u00B0";break;case"dm":var b=(f*60).toFixed(i);var h=Math.floor(b/60);var a=(b%60).toFixed(i);if(h<100){h="0"+h}if(h<10){h="0"+h}if(a<10){a="0"+a}dms=h+"\u00B0"+a+"\u2032";break;case"dms":var e=(f*3600).toFixed(i);var h=Math.floor(e/3600);var a=Math.floor(e/60)%60;var c=(e%60).toFixed(i);if(h<100){h="0"+h}if(h<10){h="0"+h}if(a<10){a="0"+a}if(c<10){c="0"+c}dms=h+"\u00B0"+a+"\u2032"+c+"\u2033";break}return dms};Geo.toLat=function(a,c,d){var b=Geo.toDMS(a,c,d);return b==""?"":b.slice(1)+(a<0?"S":"N")};Geo.toLon=function(a,b,d){var c=Geo.toDMS(a,b,d);return c==""?"":c+(a<0?"W":"E")};Geo.toBrng=function(b,c,d){b=(Number(b)+360)%360;var a=Geo.toDMS(b,c,d);return a.replace("360","0")};